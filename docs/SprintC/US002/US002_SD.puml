@startuml

autonumber

actor Receptionist as R

participant ":ScheduleVaccineUI" as UI
participant ":ScheduleVaccineController" as CTRL
participant "vaccinationCenter\n:VaccinationCenter" as VC
participant "snsUser\n:SnsUser" as SU
participant "scheduledVaccineDtoMapper\n:ScheduledVaccineMapper" as M
participant "scheduledVaccineDto\n:ScheduledVaccineDto" as DTO
participant "scheduledVaccine\n:ScheduledVaccine" as SV
participant "appointmentsList\nList<ScheduledVaccine>" as L


activate R
R -> UI : asks to schedule a vaccine
activate UI
UI --> R : requests user´s SNS number
deactivate UI
R -> UI : introduces user´s SNS number

activate UI
UI --> R : shows a list with the available vaccination centers
deactivate UI
R -> UI : selects one vaccination center


activate UI
 UI --> R : shows a list with the Vaccine Types available
deactivate UI
R -> UI : selects one Vaccine Type


activate UI
 UI --> R : shows a list with all the dates available
deactivate UI
R -> UI : selects one date


activate UI
 UI --> R : shows a list with all the slots available
deactivate UI
R -> UI : selects one slot



activate UI
UI -> CTRL : validateAppointment(scheduleVaccineDto, vaccinationCenter)

activate CTRL
CTRL -> CTRL : dataIsAllFilled(scheduleVaccineDto)
activate CTRL
deactivate CTRL
CTRL -> SV : userIsEligibleForTheAppointment(scheduledVaccineDto)
activate SV
SV ---> CTRL : result
deactivate SV



CTRL -> SU : validateAppointmentAccordingToAgeGroupAndTimeSinceLastDose(scheduledVaccineDto)

activate SU
SU ---> CTRL : result
deactivate SU

CTRL -> VC : centerHasAvailability(scheduledVaccineDto)
activate VC
VC ---> CTRL : result
deactivate VC


CTRL ---> UI : result
deactivate CTRL

UI -> R : shows the data and requests confirmation
deactivate UI

R -> UI : confirms the data
activate UI

UI -> CTRL : scheduledVaccine(scheduleVaccineDto, vaccinationCenter)
activate CTRL


CTRL -> VC : centerHasAvailability(scheduleVaccineDto)

activate VC
VC ---> CTRL : result
deactivate VC
CTRL -> M : scheduledVaccine = createScheduledVaccine(scheduleVaccineDto)
activate M
note over M, DTO
Several steps to extract data from the DTO
end note
M ---> SV ** : createScheduledVaccine(scheduleVaccineDto)
activate SV
deactivate SV
deactivate M

CTRL -> VC : addAppointment(scheduledVaccine)
activate VC


VC -> L : addAppointment(scheduledVaccine)
activate L
L --> VC : result

deactivate L

VC --> CTRL : result

deactivate VC



CTRL ---> UI : result
deactivate CTRL
UI --> R : informs operation success and shows appointment information

UI -> R : asks if the user wants to receive an SMS with the appointment information
deactivate UI

R -> UI : authorizes the application to send him an SMS
activate UI
UI -> UI : printAppointmentToFile(scheduledVaccineDto, vaccinationCenter)
activate UI
deactivate UI
UI ---> R : informs operation success
deactivate UI
deactivate R
@enduml